from main import app
import pyrogram
from pyrogram import filters, idle
from pyrogram.errors import FloodWait
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup, Message, CallbackQuery
from main.logo import generate_logo

START = """
**ğŸ”® Hello There, You Can Use Me To Create Awesome Logos...**

â¤ Click /help Or The Button Below To Know How To Use Me
"""
STARTB = [
            [
                InlineKeyboardButton('ğŸ†˜HELPğŸ†˜', callback_data="HELP_CALLBACK")
            ],
            [
                InlineKeyboardButton(' ğŸ’ŒSUPPORTğŸ’Œ', url='https://t.me/EpicChats'),
                InlineKeyboardButton(' âš¡CREATORâš¡', url='https://t.me/NA_VA_N_JA_NA1')
            ],
            [
                InlineKeyboardButton('</á´‡á´˜Éªá´„ Ê™á´á´›s <s/ÊŸ>ğŸ‡±ğŸ‡°', url='https://t.me/EpicBotsSl')
            ]
        ]

HELP = """
**ğŸ’¡How To Use Epic Logo Bot**

**Make Normal Logos -** `/logo Your Name`
**Make Square Logos - ** `/logosq Your Name`

**â™»ï¸ Example:** 
`/logo EpicBots`
`/logosq EpicBots`
"""
HELP_BTN = [
   [InlineKeyboardButton('Back', callback_data="BACK_MENU")]
]

# Commands
@app.on_message(filters.command("start"))
async def start(bot, message):
  await message.reply_photo("https://telegra.ph/file/57f8a652ee527500864e5.jpg",caption=START,reply_markup=InlineKeyboardMarkup(STARTB), reply_sticker='CAACAgUAAxkBAAEFFdRisHcr0C1_svwE_gAB2PhkruEaZcgAAoUGAAI2X4lVZVPINGURBWcoBA')

@app.on_message(filters.command("help"))
async def help(bot, message):
  await message.reply_photo("https://telegra.ph/file/57f8a652ee527500864e5.jpg",caption=HELP,reply_markup=InlineKeyboardMarkup(HELP_BTN), reply_sticker='CAACAgUAAxkBAAEFFdRisHcr0C1_svwE_gAB2PhkruEaZcgAAoUGAAI2X4lVZVPINGURBWcoBA')

@app.on_message(filters.command("logo") & filters.incoming & filters.text & ~filters.forwarded & (
  filters.group | filters.private))
async def logo(bot, message):
  try:
    text = message.text.replace("logo","").replace("/","").replace("@TechZLogoMakerBot","").strip().upper()
    
    if text == "":
      return await message.reply_text(HELP)

    x = await message.reply_text("`ğŸ” Generating Logo For You...`")  
    logo = await generate_logo(text)

    if "telegra.ph" not in logo:
      return await x.edit("`âŒ Something Went Wrong...`\n\nReport This Error In @TechZBots_Support")
      
    if "error" in logo:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In @TechZBots_Support \n\n`{logo}`")
      
    await x.edit("`ğŸ”„ Done Generated... Now Sending You`")

    logo_id = logo.replace("https://telegra.ph//file/","").replace(".jpg","").strip()
    await message.reply_photo(logo,caption="**ğŸ”¥ Logo Generated By á´‡á´˜Éªá´„ Ê™á´á´›s ğŸ‡±ğŸ‡°**",reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton(text="Upload As File ğŸ“", callback_data=f"flogo {logo_id}")]]))
    await x.delete()
  except FloodWait:
    pass
  except Exception as e:
    try:
      await x.delete()
    except:
      pass
    return await message.reply_text("`âŒ Something Went Wrong...`\n\nReport This Error In @EpicChats")

# Square Logo
@app.on_message(filters.command("logosq") & filters.incoming & filters.text & ~filters.forwarded & (
  filters.group | filters.private))
async def logo(bot, message):
  try:
    text = message.text.replace("logosq","").replace("/","").replace("@TechZLogoMakerBot","").strip().upper()
      
    if text == "":
      return await message.reply_text(HELP)
  
    x = await message.reply_text("`ğŸ” Generating Logo For You...`")  
    logo = await generate_logo(text,True)
  
    if "telegra.ph" not in logo:
      return await x.edit("`âŒ Something Went Wrong...`\n\nReport This Error In @EpicChats")
        
    if "error" in logo:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In @EpicChats \n\n`{logo}`")
      
    await x.edit("`ğŸ”„ Done Generated...Epic Team logo Sending You`")
    
    logo_id = logo.replace("https://telegra.ph//file/","").replace(".jpg","").strip()
    
    await message.reply_photo(logo,caption="**ğŸ”¥ Logo Generated By á´‡á´˜Éªá´„ Ê™á´á´›s ğŸ‡±ğŸ‡°**",reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton(text="Upload As File ğŸ“", callback_data=f"flogo {logo_id}")]]))
    await x.delete()
  except FloodWait:
    pass
  except Exception as e:
    try:
      await x.delete()
    except:
      pass
    return await message.reply_text("`âŒ Something Went Wrong...`\n\nReport This Error In @EpicChats")

# Callbacks
@app.on_callback_query(filters.regex("HELP_CALLBACK"))
async def start_menu(_,query):
  await query.answer()
  await query.message.edit(HELP,reply_markup=InlineKeyboardMarkup(HELP_BTN))
  
@app.on_callback_query(filters.regex("BACK_MENU"))
async def back_menu(_,query):
  await query.answer()
  await query.message.edit(START,reply_markup=InlineKeyboardMarkup(STARTB))

@app.on_callback_query(filters.regex("flogo"))
async def logo_doc(_,query):
  await query.answer()
  try:
    x = await query.message.reply_text("`ğŸ”„ Sending You The Logo As File`")
    await query.message.edit_reply_markup(reply_markup=None)
    link = "https://telegra.ph//file/" + query.data.replace("flogo","").strip() + ".jpg"
    await query.message.reply_document(link,caption="**ğŸ–¼ Logo Generated By </á´‡á´˜Éªá´„ Ê™á´á´›s <s/ÊŸ>ğŸ‡±ğŸ‡°**")
  except FloodWait:
    pass
  except Exception as e:
    try:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In @TechZBots_Support \n\n`{str(e)}`")
    except:
      return
    
  return await x.delete()
  

if __name__ == "__main__":
  print("==|===|=======|======|=====|==|=======|==")
  print("[INFO]: EPIC MAKER BOT STARTED BOT SUCCESSFULLY")
  print("======|====JOIN </á´‡á´˜Éªá´„ Ê™á´á´›s <s/ÊŸ>ğŸ‡±ğŸ‡°====|=====")

  idle()
  print("[INFO]: EPIC LOGO MAKER BOT STOPPED")
